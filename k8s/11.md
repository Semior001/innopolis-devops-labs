# k8s secrets

## creating secret
```plain
$ kubectl create secret generic test-secret --from-literal=super_secret_key=1234567890secret 
secret/test-secret created
$ kubectl get secrets 
NAME                               TYPE                 DATA   AGE
sh.helm.release.v1.app-python.v1   helm.sh/release.v1   1      8m46s
test-secret                        Opaque               1      5s
$ kubectl describe secret test-secret 
Name:         test-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
super_secret_key:  16 bytes
$ kubectl get secret test-secret -o jsonpath='{.data}' 
{"super_secret_key":"MTIzNDU2Nzg5MHNlY3JldA=="}% 
$ kubectl get secret test-secret -o jsonpath='{.data.super_secret_key}' | base64 -d 
1234567890secret% 
```

## helm secrets
```plain
$ helm plugin install https://github.com/jkroepke/helm-secrets 
Installed plugin: secrets
$ gpg --gen-key 
gpg (GnuPG) 2.4.0; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Note: Use "gpg --full-generate-key" for a full featured key generation dialog.

GnuPG needs to construct a user ID to identify your key.

Real name: devops-11
Email address: semior001@ya.ru
You selected this USER-ID:
    "devops-11 <semior001@ya.ru>"

Change (N)ame, (E)mail, or (O)kay/(Q)uit? O
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
gpg: revocation certificate stored as '/Users/semior/.gnupg/openpgp-revocs.d/55796E3903943E3CD2975D96DD972C952E5A5328.rev'
public and secret key created and signed.

pub   ed25519 2023-02-18 [SC] [expires: 2025-02-17]
      55796E3903943E3CD2975D96DD972C952E5A5328
uid                      devops-11 <semior001@ya.ru>
sub   cv25519 2023-02-18 [E] [expires: 2025-02-17]


$ sops -p 55796E3903943E3CD2975D96DD972C952E5A5328 secrets.yaml 
[PGP]    WARN[0000] Deprecation Warning: GPG key fetching from a keyserver within sops will be removed in a future version of sops. See https://github.com/mozilla/sops/issues/727 for more information.

$ helm secrets install app-python ./app-python -f secrets.yaml -f ./app-python/values.yaml 
[helm-secrets] Decrypt: secrets.yaml
NAME: app-python
LAST DEPLOYED: Sun Feb 19 01:14:18 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w app-python'
  export SERVICE_IP=$(kubectl get svc --namespace default app-python --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:80

[helm-secrets] Removed: secrets.yaml.dec

$ kubectl get pods 
NAME                          READY   STATUS    RESTARTS      AGE
app-python-555d448b99-b64mk   1/1     Running   1 (15s ago)   76s
$ kubectl exec app-python-555d448b99-b64mk  -- printenv | grep SECRET 
SECRET=super_secret_value

$ kubectl describe pods app-python-555d448b99-b64mk | grep -A 5 Limits 
    Limits:
      cpu:     2
      memory:  256Mi
    Requests:
      cpu:      1
      memory:   128Mi
```
